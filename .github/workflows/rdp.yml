name: ðŸš€ Windows 10 RDP - 24/7

on:
  # Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Push Ø£Ùˆ Schedule
  push:
    branches: [ main ]
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 5 Ø³Ø§Ø¹Ø§Øª Ùˆ 50 Ø¯Ù‚ÙŠÙ‚Ø© (10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù€ 6 Ø³Ø§Ø¹Ø§Øª)
    - cron: '0 */5 * * *'
  workflow_dispatch:
    inputs:
      custom_password:
        description: 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù…Ø®ØµØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)'
        required: false
      enable_auto_restart:
        description: 'ØªÙØ¹ÙŠÙ„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  # Job 1: Ø¥Ø¹Ø¯Ø§Ø¯ RDP ÙˆØªØ´ØºÙŠÙ„Ù‡
  setup-rdp:
    runs-on: windows-2019
    timeout-minutes: 355  # 5 Ø³Ø§Ø¹Ø§Øª Ùˆ 55 Ø¯Ù‚ÙŠÙ‚Ø© (Ù‡Ø§Ù…Ø´ 5 Ø¯Ù‚Ø§Ø¦Ù‚)
    
    steps:
      - name: ðŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Windows 10 RDP
        shell: pwsh
        run: |
          # ==========================================
          # Ø§Ù„Ø¬Ø²Ø¡ 1: ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
          # ==========================================
          Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     24/7" -ForegroundColor Cyan
          Write-Host "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    Windows 10" -ForegroundColor Cyan
          Write-Host "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    RDP System" -ForegroundColor Cyan
          Write-Host "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â•     Auto-Restart" -ForegroundColor Cyan
          Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         Activated âœ“" -ForegroundColor Green
          Write-Host "â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•" -ForegroundColor Cyan
          
          # ØªØ¹Ø·ÙŠÙ„ UAC
          Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System" `
            -Name "EnableLUA" -Value 0 -Force
          
          # ØªÙ…ÙƒÙŠÙ† RDP
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" `
            -Name "fDenyTSConnections" -Value 0 -Force
          
          # ØªØ¹Ø·ÙŠÙ„ NLA Ù„Ù„ØªÙˆØ§ÙÙ‚
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" `
            -Name "UserAuthentication" -Value 0 -Force
          
          # ØªØ¹Ø·ÙŠÙ„ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
          Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
          
          # ==========================================
          # Ø§Ù„Ø¬Ø²Ø¡ 2: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…
          # ==========================================
          $username = "Win10User"
          
          # Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙˆØ¬Ø¯
          Remove-LocalUser -Name $username -ErrorAction SilentlyContinue
          
          # ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©
          $password = -join ((65..90) + (97..122) + (48..57) + (33,35,36,37,38) | Get-Random -Count 16 | % {[char]$_})
          
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          New-LocalUser -Name $username `
            -Password $securePass `
            -FullName "Windows 10 RDP User" `
            -Description "24/7 RDP Access Account"
          
          # Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
          Add-LocalGroupMember -Group "Administrators" -Member $username
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member $username
          
          # ØªØ¹Ø·ÙŠÙ„ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨
          Set-LocalUser -Name $username -PasswordNeverExpires $true -AccountNeverExpires
          
          # ==========================================
          # Ø§Ù„Ø¬Ø²Ø¡ 3: Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ÙÙŠ Ù…Ù„Ù
          # ==========================================
          $credFile = "C:\RDP_Credentials.txt"
          $connectionInfo = @"
==========================================
Windows 10 RDP - 24/7 System
==========================================
ðŸ“… Created: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
â° Next Restart: $(Get-Date).AddMinutes(350)
ðŸ”„ Auto-Restart: ENABLED

ðŸ” CREDENTIALS:
Username: $username
Password: $password

ðŸ”— CONNECTION:
1. Connect via RDP (mstsc.exe)
2. Use credentials above
3. Auto-restart every ~6 hours

ðŸ“Š SYSTEM INFO:
Hostname: $env:COMPUTERNAME
IP: $(Get-NetIPAddress -AddressFamily IPv4 | Where-Object {$_.InterfaceAlias -notlike "*Loopback*"} | Select-Object -First 1).IPAddress
Session ID: $env:GITHUB_RUN_ID

âš ï¸  This session will auto-restart to maintain 24/7 uptime
==========================================
"@
          
          $connectionInfo | Out-File -FilePath $credFile -Encoding UTF8
          
          # Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙƒÙ€ Secret
          echo "RDP_PASSWORD=$password" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding UTF8
          echo "RDP_USERNAME=$username" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding UTF8
          
          Write-Host "âœ… System configured successfully!"
          Write-Host "ðŸ“‹ Credentials saved to: $credFile"

      - name: ðŸ“¡ ØªØ«Ø¨ÙŠØª Tailscale (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        if: ${{ secrets.TAILSCALE_AUTH_KEY != '' }}
        shell: pwsh
        run: |
          Write-Host "Installing Tailscale for secure access..."
          $url = "https://pkgs.tailscale.com/stable/tailscale-setup-amd64.msi"
          $installer = "$env:TEMP\tailscale.msi"
          
          Invoke-WebRequest -Uri $url -OutFile $installer
          Start-Process msiexec.exe -Wait -ArgumentList "/i", "`"$installer`"", "/quiet", "/norestart"
          Remove-Item $installer -Force
          
          # Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Tailscale
          $hostname = "win10-24-7-$env:GITHUB_RUN_ID"
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up `
            --authkey="${{ secrets.TAILSCALE_AUTH_KEY }}" `
            --hostname="$hostname" `
            --accept-routes `
            --accept-dns
          
          Start-Sleep -Seconds 10
          $tailscaleIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
          $tailscaleIP = $tailscaleIP.Trim()
          
          echo "TAILSCALE_IP=$tailscaleIP" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding UTF8

      - name: ðŸ› ï¸ ØªØ«Ø¨ÙŠØª Ø¨Ø±Ø§Ù…Ø¬ Ù…ÙÙŠØ¯Ø©
        shell: pwsh
        run: |
          Write-Host "Installing essential software..."
          
          # Chrome
          $chromeUrl = "https://dl.google.com/chrome/install/latest/chrome_installer.exe"
          $chromePath = "$env:TEMP\chrome_installer.exe"
          Invoke-WebRequest -Uri $chromeUrl -OutFile $chromePath
          Start-Process -FilePath $chromePath -ArgumentList "/silent /install" -Wait
          Remove-Item $chromePath -Force
          
          # 7-Zip
          $7zipUrl = "https://www.7-zip.org/a/7z2201-x64.exe"
          $7zipPath = "$env:TEMP\7zip.exe"
          Invoke-WebRequest -Uri $7zipUrl -OutFile $7zipPath
          Start-Process -FilePath $7zipPath -ArgumentList "/S" -Wait
          Remove-Item $7zipPath -Force
          
          # VLC Media Player
          $vlcUrl = "https://get.videolan.org/vlc/3.0.18/win64/vlc-3.0.18-win64.exe"
          $vlcPath = "$env:TEMP\vlc.exe"
          Invoke-WebRequest -Uri $vlcUrl -OutFile $vlcPath
          Start-Process -FilePath $vlcPath -ArgumentList "/S" -Wait
          Remove-Item $vlcPath -Force

      - name: ðŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯ Auto-Restart Service
        shell: pwsh
        run: |
          # Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
          $restartScript = @'
param([int]$Minutes = 350)

function Write-Log {
    param([string]$Message)
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logMessage = "[$timestamp] $Message"
    Write-Host $logMessage
    $logMessage | Out-File -FilePath "C:\AutoRestart.log" -Append -Encoding UTF8
}

Write-Log "=== Auto-Restart Service Started ==="
Write-Log "Session will restart in $Minutes minutes"

# Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
$startTime = Get-Date
$endTime = $startTime.AddMinutes($Minutes)

while ((Get-Date) -lt $endTime) {
    $remaining = $endTime - (Get-Date)
    $hours = [math]::Floor($remaining.TotalHours)
    $minutes = [math]::Floor($remaining.TotalMinutes % 60)
    $seconds = [math]::Floor($remaining.TotalSeconds % 60)
    
    Write-Log "Remaining: ${hours}h ${minutes}m ${seconds}s"
    
    # ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ ØªØ­Ù‚Ù‚
    if ($remaining.TotalMinutes -le 10) {
        Write-Log "âš ï¸  Warning: Session ending soon!"
        
        # ØªØ´ØºÙŠÙ„ workflow Ø¬Ø¯ÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ù‡Ø°Ø§
        if ($remaining.TotalMinutes -le 5) {
            Write-Log "ðŸš€ Triggering new workflow..."
            
            # Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© API call Ù„ØªØ´ØºÙŠÙ„ workflow Ø¬Ø¯ÙŠØ¯
            # Ù†Ø³ØªØ®Ø¯Ù… Ù…Ù„Ù batch Ø¨Ø¯ÙŠÙ„
            $triggerScript = @"
@echo off
timeout /t 300 /nobreak > nul
echo Starting new session...
"@
            
            $triggerScript | Out-File -FilePath "C:\TriggerNext.bat" -Encoding ASCII
            Start-Process -FilePath "cmd.exe" -ArgumentList "/c C:\TriggerNext.bat" -WindowStyle Hidden
        }
    }
    
    Start-Sleep -Seconds 300  # Ø§Ù†ØªØ¸Ø§Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚
}

Write-Log "=== Auto-Restart Service Finished ==="
Write-Log "Session completed successfully"
'@
          
          $restartScript | Out-File -FilePath "C:\AutoRestart.ps1" -Encoding UTF8
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ù…Ø¬Ø¯ÙˆÙ„Ø©
          $action = New-ScheduledTaskAction -Execute "powershell.exe" `
            -Argument "-ExecutionPolicy Bypass -File C:\AutoRestart.ps1 -Minutes 350"
          
          $trigger = New-ScheduledTaskTrigger -AtStartup
          $principal = New-ScheduledTaskPrincipal -UserId "SYSTEM" -LogonType ServiceAccount -RunLevel Highest
          $settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries
          
          Register-ScheduledTask -TaskName "RDP_AutoRestart" `
            -Action $action `
            -Trigger $trigger `
            -Principal $principal `
            -Settings $settings `
            -Description "Auto-restart RDP session every 6 hours" `
            -Force

      - name: ðŸ“Š Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
        shell: pwsh
        run: |
          $username = "${{ steps.setup-rdp.outputs.RDP_USERNAME }}"
          $password = "${{ steps.setup-rdp.outputs.RDP_PASSWORD }}"
          
          # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ IP
          $ip = Get-NetIPAddress -AddressFamily IPv4 | 
                Where-Object {$_.InterfaceAlias -notlike "*Loopback*"} | 
                Select-Object -First 1 | 
                ForEach-Object {$_.IPAddress}
          
          $tailscaleIP = "${{ steps.setup-rdp.outputs.TAILSCALE_IP }}"
          
          # Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
          Write-Host ""
          Write-Host "â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—" -ForegroundColor Green
          Write-Host "â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•" -ForegroundColor Green
          Write-Host "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•”â•â–‘" -ForegroundColor Green
          Write-Host "â–‘â•šâ•â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–‘" -ForegroundColor Green
          Write-Host "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘â•šâ•â–ˆâ–ˆâ•”â•â•â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ•â•â–‘" -ForegroundColor Green
          Write-Host "â•šâ•â•â•â•â•â•â–‘â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘â–‘â–‘â–‘â•šâ•â•â•â•â•â–‘â–‘â–‘â–‘â–‘" -ForegroundColor Green
          Write-Host ""
          Write-Host "=================================================="
          Write-Host "ðŸ–¥ï¸  WINDOWS 10 RDP - 24/7 ACTIVE"
          Write-Host "=================================================="
          
          if ($tailscaleIP) {
              Write-Host "ðŸŒ Tailscale IP: $tailscaleIP" -ForegroundColor Cyan
          }
          
          Write-Host "ðŸŒ Local IP: $ip" -ForegroundColor Cyan
          Write-Host "ðŸ‘¤ Username: $username" -ForegroundColor Yellow
          Write-Host "ðŸ”‘ Password: $password" -ForegroundColor Red
          Write-Host ""
          Write-Host "â° Session Duration: ~6 hours"
          Write-Host "ðŸ”„ Auto-Restart: ENABLED"
          Write-Host ""
          Write-Host "ðŸ“‹ Quick Connection Command:" -ForegroundColor Green
          Write-Host "mstsc /v:$ip"
          Write-Host ""
          Write-Host "âš ï¸  This session will auto-restart to maintain 24/7 uptime"
          Write-Host "=================================================="
          Write-Host ""
          
          # Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒÙ€ Artifact
          $info = @{
            username = $username
            password = $password
            ip = $ip
            tailscale_ip = $tailscaleIP
            session_id = $env:GITHUB_RUN_ID
            start_time = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
            end_time = (Get-Date).AddMinutes(350).ToString("yyyy-MM-dd HH:mm:ss")
          }
          
          $infoJson = $info | ConvertTo-Json
          $infoJson | Out-File -FilePath "connection_info.json" -Encoding UTF8

      - name: ðŸ’¾ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
        uses: actions/upload-artifact@v4
        with:
          name: rdp-connection-info
          path: connection_info.json
          retention-days: 1

      - name: â³ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©
        shell: pwsh
        run: |
          # ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Auto-Restart
          Start-Process powershell.exe -ArgumentList "-ExecutionPolicy Bypass -File C:\AutoRestart.ps1 -Minutes 350" -WindowStyle Hidden
          
          # Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù†Ø´Ø·Ø©
          Write-Host "Main session keeping alive for 350 minutes (5h 50m)..."
          $counter = 0
          $totalMinutes = 350
          
          while ($counter -lt $totalMinutes) {
              $remaining = $totalMinutes - $counter
              $hours = [math]::Floor($remaining / 60)
              $minutes = $remaining % 60
              
              Write-Host "[$(Get-Date -Format 'HH:mm:ss')] Active - $hoursh ${minutes}m remaining"
              
              # ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ ØªØ­Ù‚Ù‚
              if ($remaining -le 10) {
                  Write-Host "âš ï¸  Warning: Session ending in $remaining minutes"
                  
                  # Ø¹Ù†Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŒ ØªØ´ØºÙŠÙ„ workflow Ø¬Ø¯ÙŠØ¯
                  if ($remaining -le 5) {
                      Write-Host "ðŸš€ Preparing to start new session..."
                      
                      # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù trigger Ù„Ù„Ù€ workflow Ø§Ù„ØªØ§Ù„ÙŠ
                      $triggerFile = @"
on:
  workflow_dispatch:

jobs:
  next-session:
    runs-on: windows-2019
    steps:
      - run: echo "Next session starting..."
"@
                      
                      $triggerFile | Out-File -FilePath "C:\NextWorkflow.yml" -Encoding UTF8
                  }
              }
              
              Start-Sleep -Seconds 300  # 5 Ø¯Ù‚Ø§Ø¦Ù‚
              $counter += 5
          }
          
          Write-Host "Session completed successfully!"
          Write-Host "New session will start automatically via schedule"

  # Job 2: Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª (ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ubuntu)
  monitor-sessions:
    needs: setup-rdp
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.enable_auto_restart == 'true' || !github.event.inputs.enable_auto_restart }}
    
    steps:
      - name: ðŸ“Š Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        run: |
          echo "ðŸŽ¯ Session Monitor Started"
          echo "ðŸ“ˆ Monitoring RDP session ${{ github.run_id }}"
          echo "â° Will trigger new session in 5 hours 45 minutes"
          
          # Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 5 Ø³Ø§Ø¹Ø§Øª Ùˆ 45 Ø¯Ù‚ÙŠÙ‚Ø©
          sleep 20700
          
          echo "ðŸ”„ Time to start new session!"
          
      - name: ðŸ”„ ØªØ´ØºÙŠÙ„ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… GitHub API Ù„ØªØ´ØºÙŠÙ„ workflow Ø¬Ø¯ÙŠØ¯
          curl -X POST \
            -H "Authorization: Bearer $GH_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/${{ github.workflow }}/dispatches \
            -d '{"ref":"main"}'
          
          echo "âœ… New session triggered successfully!"
          
      - name: ðŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·
        run: |
          echo "ðŸ“… $(date)" >> session_log.txt
          echo "ðŸ”„ Restarted session: ${{ github.run_id }}" >> session_log.txt
          echo "---" >> session_log.txt

      - uses: actions/upload-artifact@v4
        with:
          name: session-monitor-log
          path: session_log.txt
